openapi: 3.1.0
info:
  title: KubeNova API
  version: 0.1.2
  description: |
    Stable v0.1.2 surface for the KubeNova Manager. All responses use structured errors
    with `code` and `message` fields (KN-###).
servers:
  - url: http://localhost:8080
paths:
  /api/v1/healthz:
    get:
      summary: Liveness probe
      responses:
        '200':
          description: Service is alive
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
              example:
                status: ok
  /api/v1/readyz:
    get:
      summary: Readiness probe
      responses:
        '200':
          description: Store reachable
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
              example:
                status: ready
        '503':
          $ref: '#/components/responses/Error'
  /api/v1/version:
    get:
      summary: API version
      responses:
        '200':
          description: Current version
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: string
              example:
                version: 0.1.2
  /api/v1/features:
    get:
      summary: Feature flags
      responses:
        '200':
          description: Enabled features
          content:
            application/json:
              schema:
                type: object
              example:
                auth: true
                components: [capsule, capsule-proxy, kubevela]
  /api/v1/telemetry/events:
    post:
      summary: Ingest operator telemetry event
      description: Used by the in-cluster operator to report component install/reconcile failures.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelemetryEvent'
            example:
              stream: component_install
              component: cert-manager
              status: error
              error: "exit status 1"
              clusterId: 7ae0a156-92cd-40fe-ba4a-fbab55ee9d22
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                type: object
              example:
                status: received
  /api/v1/tokens:
    post:
      summary: Issue JWT
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TokenRequest'
            example:
              subject: admin@example.com
              roles: [admin]
              ttlMinutes: 60
      responses:
        '201':
          description: Token issued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
              example:
                token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                expiresAt: 2024-01-01T00:00:00Z
        '500':
          $ref: '#/components/responses/Error'
  /api/v1/me:
    get:
      security: [{ bearerAuth: [] }]
      summary: Inspect current identity
      responses:
        '200':
          description: Claims
          content:
            application/json:
              schema:
                type: object
                properties:
                  subject:
                    type: string
                  roles:
                    type: array
                    items:
                      type: string
              example:
                subject: admin@example.com
                roles: [admin]
        '401':
          $ref: '#/components/responses/Error'
  /api/v1/clusters:
    get:
      security: [{ bearerAuth: [] }]
      summary: List clusters
      responses:
        '200':
          description: Cluster collection
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Cluster'
              example:
                - id: 2c7b6b18-1f1b-4e4c-8af1-111111111111
                  name: prod-a
                  datacenter: eu-west
                  status: pending_bootstrap
                  capsuleProxyEndpoint: https://proxy.prod.example.com
                  capabilities:
                    capsule: true
                    capsuleProxy: true
                    kubeVela: true
                  createdAt: 2024-01-01T00:00:00Z
                  updatedAt: 2024-01-01T00:00:00Z
    post:
      security: [{ bearerAuth: [] }]
      summary: Register cluster
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClusterRequest'
            example:
              name: prod-a
              datacenter: eu-west
              capsuleProxyEndpoint: https://proxy.prod.example.com
              kubeconfig: YXBpVmVyc2lvbjogdjEKa2luZDogQ29uZmlnCmNsdXN0ZXJzOgotIGNsdXN0ZXI6CiAgICBzZXJ2ZXI6IGh0dHBzOi8vMS4yLjMuNDo2NDQzCiAgICBpbnNlY3VyZS1za2lwLXRscy12ZXJpZnk6IHRydWUKICBuYW1lOiBkZXYKY29udGV4dHM6Ci0gY29udGV4dDoKICAgIGNsdXN0ZXI6IGRldgogICAgdXNlcjogZGV2CiAgbmFtZTogZGV2CmN1cnJlbnQtY29udGV4dDogZGV2CnVzZXJzOgotIG5hbWU6IGRldgogIHVzZXI6CiAgICB0b2tlbjogcGxhY2Vob2xkZXIK
              labels:
                region: eu-west
      responses:
        '201':
          description: Registered cluster
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cluster'
              example:
                id: 11111111-1111-1111-1111-111111111111
                name: dev-cluster
                datacenter: dc1
                capsuleProxyEndpoint: https://proxy.dev.example.com
                labels:
                  env: dev
                status: bootstrapping
                novaClusterId: nova-dev
                capabilities:
                  capsule: true
                  capsuleProxy: true
                  kubeVela: true
                createdAt: 2024-01-01T00:00:00Z
                updatedAt: 2024-01-01T00:00:00Z
        '409':
          $ref: '#/components/responses/Error'
        '400':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
    get:
      security: [{ bearerAuth: [] }]
      summary: Get cluster
      responses:
        '200':
          description: Cluster
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cluster'
        '404':
          $ref: '#/components/responses/Error'
    delete:
      security: [{ bearerAuth: [] }]
      summary: Delete cluster
      responses:
        '204':
          description: Deleted
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/capabilities:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
    get:
      security: [{ bearerAuth: [] }]
      summary: Cluster capabilities
      responses:
        '200':
          description: Capability flags
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Capabilities'
              example:
                capsule: true
                capsuleProxy: true
                kubeVela: true
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/bootstrap/{component}:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - in: path
        name: component
        required: true
        schema:
          type: string
        description: Component to bootstrap (capsule|capsule-proxy|kubevela|operator)
    post:
      security: [{ bearerAuth: [] }]
      summary: Kick off bootstrap for a component
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                type: object
              example:
                clusterId: 2c7b6b18-1f1b-4e4c-8af1-111111111111
                component: operator
                status: accepted
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/refresh:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
    post:
      security: [{ bearerAuth: [] }]
      summary: Reinstall all foundational components for a cluster
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                type: object
              example:
                clusterId: 2c7b6b18-1f1b-4e4c-8af1-111111111111
                status: connected
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
    get:
      security: [{ bearerAuth: [] }]
      summary: List tenants for a cluster
      responses:
        '200':
          description: Tenants
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tenant'
              example:
                - id: 22222222-2222-2222-2222-222222222222
                  clusterId: 11111111-1111-1111-1111-111111111111
                  name: acme
                  owners: [alice@example.com]
                  plan: gold
                  ownerNamespace: acme-owner
                  appsNamespace: acme-apps
                  quotas:
                    cpu: "4"
                  limits:
                    pods: "20"
                  networkPolicies: [default-deny-egress]
                  createdAt: 2024-01-01T00:05:00Z
                  updatedAt: 2024-01-01T00:05:00Z
    post:
      security: [{ bearerAuth: [] }]
      summary: Create tenant
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TenantRequest'
            example:
              name: acme
              owners: [alice@example.com]
              plan: baseline
              labels:
                tier: gold
              quotas:
                cpu: "4"
      responses:
        '201':
          description: Tenant created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenant'
              example:
                id: 22222222-2222-2222-2222-222222222222
                clusterId: 11111111-1111-1111-1111-111111111111
                name: acme
                owners: [alice@example.com]
                plan: gold
                ownerNamespace: acme-owner
                appsNamespace: acme-apps
                quotas:
                  cpu: "4"
                limits:
                  pods: "20"
                networkPolicies: [default-deny-egress]
                createdAt: 2024-01-01T00:05:00Z
                updatedAt: 2024-01-01T00:05:00Z
        '409':
          $ref: '#/components/responses/Error'
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
    get:
      security: [{ bearerAuth: [] }]
      summary: Get tenant
      responses:
        '200':
          description: Tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenant'
        '404':
          $ref: '#/components/responses/Error'
    delete:
      security: [{ bearerAuth: [] }]
      summary: Delete tenant
      responses:
        '204':
          description: Deleted
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/owners:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
    put:
      security: [{ bearerAuth: [] }]
      summary: Replace tenant owners
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OwnersRequest'
            example:
              owners: [alice@example.com, bob@example.com]
      responses:
        '200':
          description: Updated tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenant'
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/quotas:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
    put:
      security: [{ bearerAuth: [] }]
      summary: Set tenant quotas
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties:
                type: string
            example:
              cpu: "4"
              memory: 8Gi
      responses:
        '200':
          description: Updated tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenant'
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/limits:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
    put:
      security: [{ bearerAuth: [] }]
      summary: Set tenant limits
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties:
                type: string
            example:
              pods: "100"
      responses:
        '200':
          description: Updated tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenant'
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/network-policies:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
    put:
      security: [{ bearerAuth: [] }]
      summary: Update tenant network policies
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NetworkPolicyRequest'
            example:
              policies: [deny-all-egress]
      responses:
        '200':
          description: Updated tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenant'
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/summary:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
    get:
      security: [{ bearerAuth: [] }]
      summary: Tenant summary
      responses:
        '200':
          description: Summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantSummary'
              example:
                tenantId: 22222222-2222-2222-2222-222222222222
                clusterId: 11111111-1111-1111-1111-111111111111
                projects: 1
                apps: 1
                namespaces: 2
                loadBalancers: 0
                quotaViolations: 0
  /api/v1/tenants/{tenantID}/kubeconfig:
    parameters:
      - $ref: '#/components/parameters/TenantID'
    post:
      security: [{ bearerAuth: [] }]
      summary: Generate tenant kubeconfigs
      responses:
        '200':
          description: Scoped kubeconfigs
          content:
            application/json:
              schema:
                type: object
              example:
                owner: https://proxy.dev.example.com/acme/owner
                readonly: https://proxy.dev.example.com/acme/readonly
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/tenants/{tenantID}/usage:
    parameters:
      - $ref: '#/components/parameters/TenantID'
    get:
      security: [{ bearerAuth: [] }]
      summary: Tenant usage
      responses:
        '200':
          description: Aggregated usage
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usage'
              example:
                cpuRequests: "4"
                memoryRequests: "8Gi"
                pvcStorage: "50Gi"
                loadBalancers: 1
                pods: 4
                namespaces: 2
                apps: 1
                quotaViolations: 0
                lastReportedAt: 2024-01-01T01:00:00Z
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
    get:
      security: [{ bearerAuth: [] }]
      summary: List projects
      responses:
        '200':
          description: Projects
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Project'
              example:
                - id: 33333333-3333-3333-3333-333333333333
                  clusterId: 11111111-1111-1111-1111-111111111111
                  tenantId: 22222222-2222-2222-2222-222222222222
                  name: payments
                  description: Handles payment flows
                  labels:
                    env: dev
                  access: [alice@example.com]
                  createdAt: 2024-01-01T00:10:00Z
                  updatedAt: 2024-01-01T00:10:00Z
    post:
      security: [{ bearerAuth: [] }]
      summary: Create project
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectRequest'
            example:
              name: payments
              description: Payment services
      responses:
        '201':
          description: Project created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
              example:
                id: 33333333-3333-3333-3333-333333333333
                clusterId: 11111111-1111-1111-1111-111111111111
                tenantId: 22222222-2222-2222-2222-222222222222
                name: payments
                description: Handles payment flows
                access: []
                createdAt: 2024-01-01T00:10:00Z
                updatedAt: 2024-01-01T00:10:00Z
        '409':
          $ref: '#/components/responses/Error'
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
      - $ref: '#/components/parameters/ProjectID'
    get:
      security: [{ bearerAuth: [] }]
      summary: Get project
      responses:
        '200':
          description: Project
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '404':
          $ref: '#/components/responses/Error'
    put:
      security: [{ bearerAuth: [] }]
      summary: Update project
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProjectRequest'
      responses:
        '200':
          description: Updated project
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
    delete:
      security: [{ bearerAuth: [] }]
      summary: Delete project
      responses:
        '204':
          description: Deleted
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/access:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
      - $ref: '#/components/parameters/ProjectID'
    put:
      security: [{ bearerAuth: [] }]
      summary: Update project access list
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AccessRequest'
            example:
              access: [alice@example.com, bob@example.com]
      responses:
        '200':
          description: Updated project
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/kubeconfig:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
      - $ref: '#/components/parameters/ProjectID'
    get:
      security: [{ bearerAuth: [] }]
      summary: Project kubeconfig
      responses:
        '200':
          description: Scoped kubeconfig
          content:
            application/json:
              schema:
                type: object
              example:
                projectId: 1111-2222
                kubeconfig: https://proxy.dev.example.com/acme/1111-2222
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/projects/{projectID}/usage:
    parameters:
      - $ref: '#/components/parameters/ProjectID'
    get:
      security: [{ bearerAuth: [] }]
      summary: Project usage
      responses:
        '200':
          description: Usage
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usage'
              example:
                cpuRequests: "2"
                memoryRequests: "4Gi"
                pvcStorage: "10Gi"
                loadBalancers: 0
                pods: 2
                namespaces: 1
                apps: 1
                quotaViolations: 0
                lastReportedAt: 2024-01-01T01:00:00Z
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
      - $ref: '#/components/parameters/ProjectID'
    get:
      security: [{ bearerAuth: [] }]
      summary: List applications
      responses:
        '200':
          description: Applications
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/App'
              example:
                - id: 44444444-4444-4444-4444-444444444444
                  clusterId: 11111111-1111-1111-1111-111111111111
                  tenantId: 22222222-2222-2222-2222-222222222222
                  projectId: 33333333-3333-3333-3333-333333333333
                  name: api
                  description: API service
                  component: web
                  image: ghcr.io/vaheed/kubenova/kubenova-manager:dev
                  spec:
                    type: webservice
                    properties:
                      image: ghcr.io/vaheed/kubenova/kubenova-manager:dev
                      port: 8080
                  traits:
                    - type: scaler
                      properties:
                        min: 1
                        max: 3
                  revision: 1
                  status: pending
                  suspended: false
                  createdAt: 2024-01-01T00:15:00Z
                  updatedAt: 2024-01-01T00:15:00Z
    post:
      security: [{ bearerAuth: [] }]
      summary: Create application
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppRequest'
            example:
              name: web
              component: webservice
              image: ghcr.io/acme/web:1.0.0
              spec:
                type: webservice
                properties:
                  image: ghcr.io/acme/web:1.0.0
                  port: 8080
              traits:
                - type: scaler
                  properties:
                    min: 1
                    max: 3
      responses:
        '201':
          description: Application created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/App'
              example:
                id: 44444444-4444-4444-4444-444444444444
                clusterId: 11111111-1111-1111-1111-111111111111
                tenantId: 22222222-2222-2222-2222-222222222222
                projectId: 33333333-3333-3333-3333-333333333333
                name: api
                description: API service
                component: web
                image: ghcr.io/vaheed/kubenova/kubenova-manager:dev
                spec:
                  type: webservice
                  properties:
                    image: ghcr.io/vaheed/kubenova/kubenova-manager:dev
                    port: 8080
                traits:
                  - type: scaler
                    properties:
                      min: 1
                      max: 3
                revision: 1
                status: pending
                suspended: false
                createdAt: 2024-01-01T00:15:00Z
                updatedAt: 2024-01-01T00:15:00Z
        '409':
          $ref: '#/components/responses/Error'
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
      - $ref: '#/components/parameters/ProjectID'
      - $ref: '#/components/parameters/AppID'
    get:
      security: [{ bearerAuth: [] }]
      summary: Get application
      responses:
        '200':
          description: Application
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/App'
              example:
                id: 44444444-4444-4444-4444-444444444444
                clusterId: 11111111-1111-1111-1111-111111111111
                tenantId: 22222222-2222-2222-2222-222222222222
                projectId: 33333333-3333-3333-3333-333333333333
                name: api
                description: API service
                component: web
                image: ghcr.io/vaheed/kubenova/kubenova-manager:dev
                spec:
                  type: webservice
                  properties:
                    image: ghcr.io/vaheed/kubenova/kubenova-manager:dev
                    port: 8080
                traits:
                  - type: scaler
                    properties:
                      min: 1
                      max: 3
                revision: 2
                status: Deployed
                suspended: false
                createdAt: 2024-01-01T00:15:00Z
                updatedAt: 2024-01-01T00:25:00Z
        '404':
          $ref: '#/components/responses/Error'
    put:
      security: [{ bearerAuth: [] }]
      summary: Update application
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppRequest'
            example:
              description: API service v2
              spec:
                type: webservice
                properties:
                  image: ghcr.io/vaheed/kubenova/kubenova-manager:dev
                  port: 8080
      responses:
        '200':
          description: Updated app
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/App'
              example:
                id: 44444444-4444-4444-4444-444444444444
                clusterId: 11111111-1111-1111-1111-111111111111
                tenantId: 22222222-2222-2222-2222-222222222222
                projectId: 33333333-3333-3333-3333-333333333333
                name: api
                description: API service v2
                component: web
                image: ghcr.io/vaheed/kubenova/kubenova-manager:dev
                spec:
                  type: webservice
                  properties:
                    image: ghcr.io/vaheed/kubenova/kubenova-manager:dev
                    port: 8080
                traits:
                  - type: scaler
                    properties:
                      min: 1
                      max: 3
                revision: 2
                status: Deployed
                suspended: false
                createdAt: 2024-01-01T00:15:00Z
                updatedAt: 2024-01-01T00:25:00Z
  "/api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}:deploy":
    post:
      security: [{ bearerAuth: [] }]
      summary: Deploy application
      parameters:
        - $ref: '#/components/parameters/ClusterID'
        - $ref: '#/components/parameters/TenantID'
        - $ref: '#/components/parameters/ProjectID'
        - $ref: '#/components/parameters/AppID'
      responses:
        '202':
          description: Deployment enqueued
          content:
            application/json:
              schema:
                type: object
              example:
                status: Deployed
        '404':
          $ref: '#/components/responses/Error'
  "/api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}:suspend":
    post:
      security: [{ bearerAuth: [] }]
      summary: Suspend application
      parameters:
        - $ref: '#/components/parameters/ClusterID'
        - $ref: '#/components/parameters/TenantID'
        - $ref: '#/components/parameters/ProjectID'
        - $ref: '#/components/parameters/AppID'
      responses:
        '202':
          description: Suspended
          content:
            application/json:
              schema:
                type: object
              example:
                status: Suspended
  "/api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}:resume":
    post:
      security: [{ bearerAuth: [] }]
      summary: Resume application
      parameters:
        - $ref: '#/components/parameters/ClusterID'
        - $ref: '#/components/parameters/TenantID'
        - $ref: '#/components/parameters/ProjectID'
        - $ref: '#/components/parameters/AppID'
      responses:
        '202':
          description: Resumed
          content:
            application/json:
              schema:
                type: object
              example:
                status: Deployed
  "/api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}:rollback":
    post:
      security: [{ bearerAuth: [] }]
      summary: Roll back to previous revision
      parameters:
        - $ref: '#/components/parameters/ClusterID'
        - $ref: '#/components/parameters/TenantID'
        - $ref: '#/components/parameters/ProjectID'
        - $ref: '#/components/parameters/AppID'
      responses:
        '200':
          description: Rolled back
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/App'
        '422':
          $ref: '#/components/responses/Error'
  "/api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}:delete":
    post:
      security: [{ bearerAuth: [] }]
      summary: Delete application via action
      parameters:
        - $ref: '#/components/parameters/ClusterID'
        - $ref: '#/components/parameters/TenantID'
        - $ref: '#/components/parameters/ProjectID'
        - $ref: '#/components/parameters/AppID'
      responses:
        '202':
          description: Deletion enqueued
          content:
            application/json:
              schema:
                type: object
              example:
                status: deleting
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}/status:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
      - $ref: '#/components/parameters/ProjectID'
      - $ref: '#/components/parameters/AppID'
    get:
      security: [{ bearerAuth: [] }]
      summary: Application status
      responses:
        '200':
          description: Status
          content:
            application/json:
              schema:
                type: object
              example:
                status: Deployed
                revision: 2
                suspended: false
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}/revisions:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
      - $ref: '#/components/parameters/ProjectID'
      - $ref: '#/components/parameters/AppID'
    get:
      security: [{ bearerAuth: [] }]
      summary: List app revisions
      responses:
        '200':
          description: Revisions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AppRevision'
              example:
                - number: 1
                  spec:
                    type: webservice
                    properties:
                      image: ghcr.io/vaheed/kubenova/kubenova-manager:dev
                      port: 8080
                  createdAt: 2024-01-01T00:15:00Z
                - number: 2
                  spec:
                    type: webservice
                    properties:
                      image: ghcr.io/vaheed/kubenova/kubenova-manager:dev
                      port: 8080
                  createdAt: 2024-01-01T00:25:00Z
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}/diff/{revA}/{revB}:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
      - $ref: '#/components/parameters/ProjectID'
      - $ref: '#/components/parameters/AppID'
      - in: path
        name: revA
        required: true
        schema:
          type: string
      - in: path
        name: revB
        required: true
        schema:
          type: string
    get:
      security: [{ bearerAuth: [] }]
      summary: Diff two revisions
      responses:
        '200':
          description: Diff summary
          content:
            application/json:
              schema:
                type: object
              example:
                from: 1
                to: 2
                summary: changed spec from rev 1 to 2
        '404':
          $ref: '#/components/responses/Error'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}/logs/{component}:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
      - $ref: '#/components/parameters/ProjectID'
      - $ref: '#/components/parameters/AppID'
      - in: path
        name: component
        required: true
        schema:
          type: string
    get:
      security: [{ bearerAuth: [] }]
      summary: Retrieve component logs
      responses:
        '200':
          description: Log lines
          content:
            application/json:
              schema:
                type: object
              example:
                component: web
                lines:
                  - "2024-01-01T00:00:00Z starting"
                  - "2024-01-01T00:00:01Z reconciled"
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}/traits:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
      - $ref: '#/components/parameters/ProjectID'
      - $ref: '#/components/parameters/AppID'
    put:
      security: [{ bearerAuth: [] }]
      summary: Replace app traits
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppRequest'
      responses:
        '200':
          description: Updated app
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/App'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}/policies:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
      - $ref: '#/components/parameters/ProjectID'
      - $ref: '#/components/parameters/AppID'
    put:
      security: [{ bearerAuth: [] }]
      summary: Replace app policies
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppRequest'
      responses:
        '200':
          description: Updated app
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/App'
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}/workflow/run:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
      - $ref: '#/components/parameters/ProjectID'
      - $ref: '#/components/parameters/AppID'
    post:
      security: [{ bearerAuth: [] }]
      summary: Trigger workflow run
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkflowRequest'
            example:
              inputs:
                image: ghcr.io/acme/web:1.0.1
      responses:
        '202':
          description: Run started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowRun'
              example:
                id: 55555555-5555-5555-5555-555555555555
                appId: 44444444-4444-4444-4444-444444444444
                status: Running
                inputs:
                  action: smoke-test
                startedAt: 2024-01-01T00:30:00Z
  /api/v1/clusters/{clusterID}/tenants/{tenantID}/projects/{projectID}/apps/{appID}/workflow/runs:
    parameters:
      - $ref: '#/components/parameters/ClusterID'
      - $ref: '#/components/parameters/TenantID'
      - $ref: '#/components/parameters/ProjectID'
      - $ref: '#/components/parameters/AppID'
    get:
      security: [{ bearerAuth: [] }]
      summary: List workflow runs
      responses:
        '200':
          description: Workflow runs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WorkflowRun'
              example:
                - id: 55555555-5555-5555-5555-555555555555
                  appId: 44444444-4444-4444-4444-444444444444
                  status: Running
                  inputs:
                    action: smoke-test
                  startedAt: 2024-01-01T00:30:00Z
  /api/v1/apps/runs/{runID}:
    parameters:
      - in: path
        name: runID
        required: true
        schema:
          type: string
    get:
      security: [{ bearerAuth: [] }]
      summary: Get workflow run by ID
      responses:
        '200':
          description: Workflow run
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowRun'
              example:
                id: 55555555-5555-5555-5555-555555555555
                appId: 44444444-4444-4444-4444-444444444444
                status: Running
                inputs:
                  action: smoke-test
                startedAt: 2024-01-01T00:30:00Z
        '404':
          $ref: '#/components/responses/Error'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    ClusterID:
      in: path
      name: clusterID
      required: true
      schema:
        type: string
      description: Cluster identifier
    TenantID:
      in: path
      name: tenantID
      required: true
      schema:
        type: string
      description: Tenant identifier
    ProjectID:
      in: path
      name: projectID
      required: true
      schema:
        type: string
      description: Project identifier
    AppID:
      in: path
      name: appID
      required: true
      schema:
        type: string
      description: Application identifier
  responses:
    Error:
      description: Structured error response
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: KN-404
            message: not found
  schemas:
    Error:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
        message:
          type: string
    TokenRequest:
      type: object
      required: [subject]
      properties:
        subject:
          type: string
        roles:
          type: array
          items:
            type: string
        ttlMinutes:
          type: integer
    TokenResponse:
      type: object
      properties:
        token:
          type: string
        expiresAt:
          type: string
          format: date-time
    TelemetryEvent:
      type: object
      properties:
        stream:
          type: string
        component:
          type: string
        status:
          type: string
        error:
          type: string
        clusterId:
          type: string
    ClusterRequest:
      type: object
      required: [name, kubeconfig]
      properties:
        name:
          type: string
        datacenter:
          type: string
        kubeconfig:
          type: string
          description: Base64-encoded kubeconfig payload (inline YAML is accepted for compatibility but is deprecated)
        labels:
          type: object
          additionalProperties:
            type: string
        capsuleProxyEndpoint:
          type: string
          description: Base URL for the cluster's Capsule Proxy (per-cluster)
    Capabilities:
      type: object
      properties:
        capsule:
          type: boolean
        capsuleProxy:
          type: boolean
        kubeVela:
          type: boolean
    Cluster:
      allOf:
        - $ref: '#/components/schemas/ClusterRequest'
        - type: object
          properties:
            id:
              type: string
            novaClusterId:
              type: string
            status:
              type: string
            capabilities:
              $ref: '#/components/schemas/Capabilities'
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time
    TenantRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        owners:
          type: array
          items:
            type: string
        plan:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        quotas:
          type: object
          additionalProperties:
            type: string
        limits:
          type: object
          additionalProperties:
            type: string
        networkPolicies:
          type: array
          items:
            type: string
    Tenant:
      allOf:
        - $ref: '#/components/schemas/TenantRequest'
        - type: object
          properties:
            id:
              type: string
            clusterId:
              type: string
            ownerNamespace:
              type: string
            appsNamespace:
              type: string
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time
    OwnersRequest:
      type: object
      properties:
        owners:
          type: array
          items:
            type: string
    NetworkPolicyRequest:
      type: object
      properties:
        policies:
          type: array
          items:
            type: string
    TenantSummary:
      type: object
      properties:
        tenantId:
          type: string
        clusterId:
          type: string
        projects:
          type: integer
        apps:
          type: integer
        namespaces:
          type: integer
        loadBalancers:
          type: integer
        quotaViolations:
          type: integer
    ProjectRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
        labels:
          type: object
          additionalProperties:
            type: string
        access:
          type: array
          items:
            type: string
    Project:
      allOf:
        - $ref: '#/components/schemas/ProjectRequest'
        - type: object
          properties:
            id:
              type: string
            clusterId:
              type: string
            tenantId:
              type: string
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time
    AccessRequest:
      type: object
      properties:
        access:
          type: array
          items:
            type: string
    AppRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
        component:
          type: string
        image:
          type: string
        spec:
          type: object
        traits:
          type: array
          items:
            type: object
        policies:
          type: array
          items:
            type: object
    AppRevision:
      type: object
      properties:
        number:
          type: integer
        spec:
          type: object
        traits:
          type: array
          items:
            type: object
        policies:
          type: array
          items:
            type: object
        createdAt:
          type: string
          format: date-time
    App:
      allOf:
        - $ref: '#/components/schemas/AppRequest'
        - type: object
          properties:
            id:
              type: string
            clusterId:
              type: string
            tenantId:
              type: string
            projectId:
              type: string
            revision:
              type: integer
            status:
              type: string
            suspended:
              type: boolean
            revisions:
              type: array
              items:
                $ref: '#/components/schemas/AppRevision'
            workflowRuns:
              type: array
              items:
                $ref: '#/components/schemas/WorkflowRun'
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time
    WorkflowRequest:
      type: object
      properties:
        inputs:
          type: object
    WorkflowRun:
      type: object
      properties:
        id:
          type: string
        appId:
          type: string
        status:
          type: string
        inputs:
          type: object
        result:
          type: object
        startedAt:
          type: string
          format: date-time
        endedAt:
          type: string
          format: date-time
    Usage:
      type: object
      properties:
        cpuRequests:
          type: string
        memoryRequests:
          type: string
        pvcStorage:
          type: string
        loadBalancers:
          type: integer
        pods:
          type: integer
        namespaces:
          type: integer
        apps:
          type: integer
        quotaViolations:
          type: integer
        lastReportedAt:
          type: string
          format: date-time
